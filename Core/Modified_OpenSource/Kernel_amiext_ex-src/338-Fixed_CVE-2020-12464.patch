--- linux_patch334/drivers/usb/core/message.c	2020-09-24 10:03:10.315583483 +0800
+++ linux/drivers/usb/core/message.c	2020-09-24 16:09:34.809610235 +0800
@@ -582,10 +582,11 @@
 	spin_lock_irqsave(&io->lock, flags);
 
 	/* shut everything down, if it didn't already */
-	if (!io->status) {
+	if (!io->status || io->count == 0) {
 		int i;
 
 		io->status = -ECONNRESET;
+		io->count++; /* Keep the request alive until we're done */
 		spin_unlock(&io->lock);
 		for (i = 0; i < io->entries; i++) {
 			int retval;
@@ -602,6 +603,10 @@
 		}
 		spin_lock(&io->lock);
 	}
+	spin_lock_irqsave(&io->lock, flags);
+	io->count--;
+	if (!io->count)
+		complete(&io->complete);
 	spin_unlock_irqrestore(&io->lock, flags);
 }
 EXPORT_SYMBOL_GPL(usb_sg_cancel);
