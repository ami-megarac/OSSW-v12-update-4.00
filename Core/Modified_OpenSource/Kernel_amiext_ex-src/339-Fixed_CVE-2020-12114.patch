--- linux_patch334/fs/namespace.c	2020-09-24 10:02:07.999706343 +0800
+++ linux/fs/namespace.c	2020-09-24 16:25:02.734075460 +0800
@@ -2855,8 +2855,8 @@
 	/* make certain new is below the root */
 	if (!is_path_reachable(new_mnt, new.dentry, &root))
 		goto out4;
-	root_mp->m_count++; /* pin it so it won't go away */
 	lock_mount_hash();
+	root_mp->m_count++; /* pin it so it won't go away */
 	detach_mnt(new_mnt, &parent_path);
 	detach_mnt(root_mnt, &root_parent);
 	if (root_mnt->mnt.mnt_flags & MNT_LOCKED) {
