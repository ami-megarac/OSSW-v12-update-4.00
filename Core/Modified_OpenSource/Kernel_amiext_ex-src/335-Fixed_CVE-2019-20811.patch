--- linux_patch334/net/core/net-sysfs.c	2020-09-24 09:59:09.371895430 +0800
+++ linux/net/core/net-sysfs.c	2020-09-24 10:12:39.346478045 +0800
@@ -775,6 +775,8 @@
 	if (error)
 		goto exit;
 
+	dev_hold(queue->dev);
+
 	if (net->sysfs_rx_queue_group) {
 		error = sysfs_create_group(kobj, net->sysfs_rx_queue_group);
 		if (error)
@@ -782,7 +784,6 @@
 	}
 
 	kobject_uevent(kobj, KOBJ_ADD);
-	dev_hold(queue->dev);
 
 	return error;
 exit:
@@ -1137,6 +1138,8 @@
 	if (error)
 		goto exit;
 
+	dev_hold(queue->dev);
+
 #ifdef CONFIG_BQL
 	error = sysfs_create_group(kobj, &dql_group);
 	if (error)
@@ -1144,7 +1147,6 @@
 #endif
 
 	kobject_uevent(kobj, KOBJ_ADD);
-	dev_hold(queue->dev);
 
 	return 0;
 exit:
