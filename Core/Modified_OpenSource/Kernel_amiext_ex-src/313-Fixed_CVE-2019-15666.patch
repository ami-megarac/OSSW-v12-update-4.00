--- linux_patch307/net/xfrm/xfrm_user.c	2020-03-30 10:40:42.513179520 +0800
+++ linux/net/xfrm/xfrm_user.c	2020-03-31 15:09:52.009063785 +0800
@@ -1205,7 +1205,7 @@
 	ret = verify_policy_dir(p->dir);
 	if (ret)
 		return ret;
-	if (p->index && ((p->index & XFRM_POLICY_MAX) != p->dir))
+	if (p->index && (xfrm_policy_id2dir(p->index) != p->dir))
 		return -EINVAL;
 
 	return 0;
