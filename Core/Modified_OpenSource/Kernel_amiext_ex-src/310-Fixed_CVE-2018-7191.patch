--- linux_patch307/drivers/net/tun.c	2020-03-30 10:43:51.445115110 +0800
+++ linux/drivers/net/tun.c	2020-03-30 14:27:57.290119370 +0800
@@ -1659,6 +1659,9 @@
 
 		if (!dev)
 			return -ENOMEM;
+		err = dev_get_valid_name(net, dev, name);
+		if (err < 0)
+			goto err_free_dev;
 
 		dev_net_set(dev, net);
 		dev->rtnl_link_ops = &tun_link_ops;
--- linux_patch307/include/linux/netdevice.h	2020-03-30 10:44:35.457099985 +0800
+++ linux/include/linux/netdevice.h	2020-03-30 14:14:34.801747319 +0800
@@ -2911,6 +2911,9 @@
 struct net_device *alloc_netdev_mqs(int sizeof_priv, const char *name,
 				    void (*setup)(struct net_device *),
 				    unsigned int txqs, unsigned int rxqs);
+int dev_get_valid_name(struct net *net, struct net_device *dev,
+		       const char *name);
+
 #define alloc_netdev(sizeof_priv, name, setup) \
 	alloc_netdev_mqs(sizeof_priv, name, setup, 1, 1)
 
--- linux_patch307/net/core/dev.c	2020-03-30 10:40:44.785178751 +0800
+++ linux/net/core/dev.c	2020-03-30 14:15:46.865790379 +0800
@@ -1056,9 +1056,8 @@
 	return ret;
 }
 
-static int dev_get_valid_name(struct net *net,
-			      struct net_device *dev,
-			      const char *name)
+int dev_get_valid_name(struct net *net, struct net_device *dev,
+		       const char *name)
 {
 	BUG_ON(!net);
 
@@ -1074,6 +1073,7 @@
 
 	return 0;
 }
+EXPORT_SYMBOL(dev_get_valid_name);
 
 /**
  *	dev_change_name - change name of a device
